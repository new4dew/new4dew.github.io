글로벌 서비스를 위한 시스템 구축 시 아키텍처 검토사항 및 시스템 설계 방안

# 1. 아키텍처 검토사항
AWS 아키텍처 다이어그램
![AWS 아키텍처 다이어그램](./AWS아키텍처다이어그램.JPG)
## 1.1. 클라우드 (AWS 멀티리전)
### 1.1.1. 보안
### 1.1.2. 네트워크 
* VPC
* DNS
* CDN - GSLB
### 1.1.3. 인스턴스
* K8S
### 1.1.4. 스토리지
### 1.1.5. DB
### 1.1.6. Application


# 2. 시스템 설계

- 법적인 이슈에 대한 검토도 선행되어야 함. 국가별로 사용자 정보가 반드시 해당 국가에 있어야 한다든지 제약사항이 있음.   
- 시스템 위치 선정도 중요함.

## i18n / L10n
- i18n : 아키텍처나 프레임워크 범위에서 공통으로 처리할 수 있는 영역. 인코딩, 글자, 그림, 음성, 자막, 날짜/시간 형식, 통화, 이름과 직함 등
- L10n : 특정 환경(언어와 문화)에서만 적용되는 내용. 번역, 기호, 정렬의 순서, 현지의 법률이나 관습
### 다국어
- 다국어 시스템이랑 언어와 문화가 다른 사용자가 사용하는 시스템, 언어별로 시스템을 각각 구축하지 않고 시스템을 공유하면서 최소한의 수정으로 여러 언어를 지원할 수 있는 시스템, 국제화/지역화 모두 고려해야함.
#### 아키텍처 설계시 고려사항 - 다국어 적용 절차
- 설계 원칙 수립 -> 구현 프레임워크 선정 -> 추가 개발 및 적용 -> 유지보수
##### 설계 원칙 수립
1. 다국어 요건 분석 : One source multi-language, 언어별 독립적 사용 (L10n 영역)
2. 다국어 적용 대상 식별/분석 : Text (GUI Labels, Messages, Images), Currency, Date, Time, Number format
3. 다국어 적용 설계 원칙 수립 : 환경 설정 (Support Locales, Character Encoding), 데이터 관리 (Locale 의존적 데이터)
4. 다국어 적용 Big Picture 설계 : Runtime Process 설계, 연계/통합 Process 설계 (w/ 솔루션, 내부외부 시스템)
##### 구현 프레임워크 선정 
1. 프레임워크 요건 정의 : Locale 관리 (설정, 식별, 변경), Resource 관리 (국가/언어별 분리 저장, 변경, 관리/동작 반영), 각종 Formatter 제공, 성능
2. 프레임워크 평가 : 기능성, 품질, 적용성
3. 프레임워크 선정 : 평가 결과에 따라 선정
##### 추가 개발 및 적용
1. Gap 분석 : 필요 기능 대비 프레임워크 제공 기능 간 Gap 분석
2. 추가 개발 영역 도출 : 관련 항목 - 지원 가능 언어 목록 관리, Resource Repository 확장, Locale 식별 기준/위치 보완, F/W Message 분리, 오류 처리, 로깅, 코드 정의, 번역, Char Set Converter
3. 추가 개발 및 적용 
##### 유지보수
1. 언어 변경/확장 영향도 분석 : 다국어 대상 변경/증가 시 변경 사항 도출 (환경, 소스)
2. 다국어 의존적 소스/데이터 추가 : 지원 가능 언어 목록 변경, Resource Repository 확장 (파일 추가 or DB 테이블 추가 or DB 컬럼 추가)
3. 시스템 반영 (재기동or 동적) : 동적 refresh, WAS 재기동
#### 아키텍처 설계시 고려사항 - 다국어 처리 흐름
![흐름](./다국어처리흐름.JPG)
#### 아키텍처 설계시 고려사항 - 다국어 지원 환경 구성
1. OS Locale
2. Database Character set 
- 접속환경의 NLS_DATABASE_PARAMETER 확인
- UTF-8이 일반적이고 이외의 경우 원하는 char set으로 컨버팅 가능하지만 부하가 발생하므로 통일. 
- DB에 직접 접속해서 CRUD하는 경우 접속 도구를 탈 수 있으므로 주의
3. WAS
- WAS의 구동 OS Locale 정보 확인하고, Locale option 지정 (별도 지정 없으면 WAS 구동 User의 Locale 설정을 따름)
- Encoding 옵션은 WAS 실행 시 java 옵션에 -Dfile.encoding 
4. File Encoding
- 별도 설정이 없으면 Default OS Locale 따르므로 명시적 UTF-8 설정
- 빌드 시 Locale option, 실행 시 Encoding option
- properties는 경우에 따라 ISO-8859-1 이나 UTF-8
#### 아키텍처 설계시 고려사항 - 프레임워크 필요 기능
1. Locale 식별/설정/변경
- 사용자의 현재 Locale 식별/설정/변경
- 식별 시 순서 정의 필요 (ex. 세션 -> 브라우저 헤더 -> 시스템 디폴트)
- 디폴트 Locale (지원하지 않는 Locale일 경우)
2. Resource 관리
- Message를 외부 리소스에 저장해 관리
- 최종 출력 메세지 조립을 위해 파라미터 전달 기능
- 언어별 properties 파일로 분리
- 유지보수 용이성을 위해 언어별 테이블 or 컬럼 구분하여 DB로 관리
- 성능 고려한 캐싱
- WAS 재기동 없이 메세지 변경을 위해 Refresh 기능
3. Formatter 
- 숫자, 통화, 날짜, 시간
#### 아키텍처 설계시 고려사항 - Advanced
1. 이미지
- 글자 이용한 이미지 사용 피하되, 필요시 이미지 저장 dir 분리해서 관리
2. 화면 레이아웃
- 단어의 길이 고려 (미리 완벽한 설계할 수 없고 테스트하면서 추가 작업)
- 문화에 따라 오른쪽에서 왼쪽으로 읽는 경우 메뉴 위치를 우측으로 옮기는 등의 고려 필요
3. Logging, Exception
- Message는 다국어 처리 고려해야하지만 Logging, Exception의 경우 개발자가 사용하므로 개발자의 언어로 표기하고 사용자에게 전달되는 일부 에러만 다국어 메세지 처리
4. 메세지 코드 체계 관리
- Key에 대한 Naming Rule (데이터 모델링 시 함께 결정)
- 영문대문자 + _ or 영문소문자 + .
5. 파일/DB 수정 및 메모리 Re-Loading 
- 개발 중엔 메모리 캐싱 처리 off 하면 리로딩 작업 줄일 수 있음
#### 다국어 구현 사례 - DevOnFrame
1. 제공 기능
- Message Component 사용
- Message Resource를 File과 DB로 관리
- Spring에서 Message 실시간 갱신 못했던 점 보완하여 refresh 기능 추가
2. 환경설정
- FileMessageSoruce
- DatabaseMessageSoruce
- MessageSourceAccessor
- messageSource.getMessage() or messageSourceAccessor.getMessage()
3. 비교
- Spring F/W 거의 유사항 기능 제공 (ReloadableResourceBundleMessageSource)


## 2.2. 인증
Token

## 2.3. MSA
-  AM ? Application Modernization, 레거시 시스템을 요구사항에 맞게 재구성
### AM 정의   
- 서비스간 높은 의존성 -> 의존성을 최소화한 유연한 구조 : Application 구조 관점 MSA
- Waterfall 방식 -> Delivery Time 최소화하는 Sprint 방식 : 일하는 방식 Agile
- 단계별/수작업 Delivery (개발, 빌드, 테스트, 배포 순) -> 자동화된 Delivery (빌드, 테스트, 배포가 병렬/자동화) : 운영환경 DevOps
### MSA 도입 시 고려사항   
1. 일단, MSA 도입이 목적인 현실의 경우
- 수긍하기 어려운 아키텍처를 도입할 가능성
- 기존 팀/서비스 관련 팀들이 목적을 이해하지 못할 가능성
2. MSA 도입으로 여러 문제점을 해결하기 기대하는 현실의 경우
- 개발 시 문제가 여전히 남게 되거나 오히려 악화 가능성
- Why에 대한 고민 없이 진행하면 실망할 수 있음
3. 프로세스, 정책, 조직 변경 없이 도입하는 현실의 경우
- 도입 시 최소 혜택만 얻게됨
- 서비스 전환 노력이 실패로 돌아갈 가능성 높음
4. 서비스를 어느 수준으로 쪼갤지 기준 불명확한 현실의 경우
- 많은 서비스로 분리할 경우 과도한 복잡성, 서비스 추적이나 모니터링 어려움
- 분산된 서비스 트랜잭션 처리, 데이터를 한번에 조회하기
5. 비즈니스 민첩성과 MSA 에 대한 잘못된 정의
- 부적합한 업무에 MSA를 도입해 민첩성 악화시킬 가능성
- 현업과 개발 조직간 MSA 구현 목적을 위한 갭 발생
  


# 9. 참고
## 글로벌 서비스 구축을 위한 AWS 멀티 리전 아키텍처 구성 가이드
https://aws.amazon.com/ko/blogs/korea/creating-a-multi-region-application-with-aws-services/

